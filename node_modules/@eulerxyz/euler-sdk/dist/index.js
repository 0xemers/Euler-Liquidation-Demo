var e=require("ethers"),r=require("tiny-invariant"),n=require("@eulerxyz/euler-interfaces/addresses/addresses-mainnet.json"),t=require("@eulerxyz/euler-interfaces/addresses/addresses-ropsten.json"),i=require("@eulerxyz/euler-interfaces/addresses/addresses-goerli.json"),s=require("@eulerxyz/euler-interfaces/abis/Eul.json"),o=require("@eulerxyz/euler-interfaces/abis/Euler.json"),a=require("@eulerxyz/euler-interfaces/abis/PToken.json"),u=require("@eulerxyz/euler-interfaces/abis/modules/EToken.json"),c=require("@eulerxyz/euler-interfaces/abis/modules/DToken.json"),d=require("@eulerxyz/euler-interfaces/abis/modules/Exec.json"),l=require("@eulerxyz/euler-interfaces/abis/modules/Liquidation.json"),f=require("@eulerxyz/euler-interfaces/abis/modules/Markets.json"),h=require("@eulerxyz/euler-interfaces/abis/modules/Swap.json"),v=require("@eulerxyz/euler-interfaces/abis/mining/EulStakes.json"),g=require("@eulerxyz/euler-interfaces/abis/mining/EulDistributor.json"),m=require("@eulerxyz/euler-interfaces/abis/views/EulerGeneralView.json");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var y=/*#__PURE__*/p(r),b=/*#__PURE__*/p(n),k=/*#__PURE__*/p(t),w=/*#__PURE__*/p(i);function T(){return T=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},T.apply(this,arguments)}function P(e,r){if(null==e)return{};var n,t,i={},s=Object.keys(e);for(t=0;t<s.length;t++)r.indexOf(n=s[t])>=0||(i[n]=e[n]);return i}function _(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}var x,C=["event Approval(address indexed owner, address indexed spender, uint value)","event Transfer(address indexed from, address indexed to, uint value)","function name() external view returns (string memory)","function symbol() external view returns (string memory)","function decimals() external view returns (uint8)","function totalSupply() external view returns (uint)","function balanceOf(address owner) external view returns (uint)","function allowance(address owner, address spender) external view returns (uint)","function approve(address spender, uint value) external returns (bool)","function transfer(address to, uint value) external returns (bool)","function transferFrom(address from, address to, uint value) external returns (bool)"],E=["function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s)","function nonces(address owner) view returns (uint)","function _nonces(address owner) view returns (uint)"],O=["function permit(address owner, address spender, uint value, uint deadline, bytes signature)","function nonces(address owner) view returns (uint)"],S=["function permit(address holder, address spender, uint256 nonce, uint256 expiry, bool allowed, uint8 v, bytes32 r, bytes32 s)","function nonces(address owner) view returns (uint)"],A={Permit:[{name:"owner",type:"address"},{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}]},j={Permit:[{name:"holder",type:"address"},{name:"spender",type:"address"},{name:"nonce",type:"uint256"},{name:"expiry",type:"uint256"},{name:"allowed",type:"bool"}]},D=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},I=function(r){y.default(e.ethers.utils.isAddress(r),"Invalid address")},q=function(e){return Math.floor((Date.now()+1e3*e)/1e3)},z=function(r){if("invalid codepoint at offset 2; missing continuation byte"===r.reason)try{var n=e.utils.defaultAbiCoder.decode(["string"],r.value.slice(4))[0];r.reason=n,r.message=n="execution reverted: "+n,r.msg=n,r.code=n}catch(e){}return r},B={__proto__:null,getSubAccountId:function(r,n){return e.BigNumber.from(r).xor(n).toNumber()},isRealSubAccount:function(r,n){return e.BigNumber.from(r).xor(n).lt(256)},getSubAccount:function(r,n){if(parseInt(n)!==n||n>256)throw"invalid subAccountId: "+n;return e.utils.hexZeroPad(e.BigNumber.from(r).xor(n).toHexString(),20)}},M={__proto__:null,eul:s.abi,euler:o.abi,pToken:a.abi,eToken:u.abi,dToken:c.abi,exec:d.abi,liquidation:l.abi,markets:f.abi,swap:h.abi,eulStakes:v.abi,eulDistributor:g.abi,eulerGeneralView:m.abi};!function(e){e.ERC20="erc20",e.EToken="eToken",e.DToken="dToken",e.PToken="pToken"}(x||(x={}));var N=["eul"],R=["eul"],U=["eul"];function L(e,r){try{var n=e()}catch(e){return r(e)}return n&&n.then?n.then(void 0,r):n}var F=["e/collateral-violation","e/borrow-isolation-violation"],G=/*#__PURE__*/function(){function r(e,r,n){var t;if(void 0===r&&(r=1),this.chainId=void 0,this.contracts=void 0,this.abis=void 0,this.addresses=void 0,this.eulTokenConfig=void 0,this.referenceAsset=void 0,this._tokenCache=void 0,this._underlyingToTokenCache=void 0,this._signerOrProvider=void 0,this.chainId=r,this._tokenCache=((t={})[x.EToken]={},t[x.DToken]={},t[x.PToken]={},t[x.ERC20]={},t),this._underlyingToTokenCache={},this._signerOrProvider=e,1===this.chainId){var i=b.default.eul,s=P(b.default,N);this.eulTokenConfig=i,this.addresses=s,this.referenceAsset="0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2"}else if(3===this.chainId){var o=k.default.eul,a=P(k.default,R);this.eulTokenConfig=o,this.addresses=a,this.referenceAsset="0xc778417e063141139fce010982780140aa0cd5ab"}else if(420===this.chainId){var u=w.default.eul,c=P(w.default,U);this.eulTokenConfig=u,this.addresses=c,this.referenceAsset="0xa3401DFdBd584E918f59fD1C3a558467E373DacC"}else{if(!n)throw new Error("Unknown configuration");y.default(n.addresses,"Missing addresses for chainId "+this.chainId),y.default(n.referenceAsset,"Missing reference asset for chainId "+this.chainId),this.addresses=n.addresses,this.referenceAsset=n.referenceAsset,this.eulTokenConfig=n.eul}this.abis=M,this.contracts=this._loadEulerContracts()}var n=r.prototype;return n.connect=function(e){var r=this;return this._signerOrProvider=e,Object.entries(this.contracts).forEach(function(n){r.contracts[n[0]]=n[1].connect(e)}),this},n.getSigner=function(){if(e.ethers.Signer.isSigner(this._signerOrProvider))return this._signerOrProvider;if(e.ethers.providers.BaseProvider.isProvider(this._signerOrProvider))try{return this._signerOrProvider.getSigner()}catch(e){}return null},n.getProvider=function(){return e.ethers.providers.BaseProvider.isProvider(this._signerOrProvider)?this._signerOrProvider:e.ethers.Signer.isSigner(this._signerOrProvider)&&this._signerOrProvider.provider?this._signerOrProvider.provider:null},n.addContract=function(r,n,t){y.default(r,"Contract name is required"),r=D(r),n=n||this.abis[r],y.default(Array.isArray(n),"Missing or invalid abi"),I(t=t||this.addresses[r]),this.contracts[r]=new e.ethers.Contract(t,n,"string"==typeof this._signerOrProvider?void 0:this._signerOrProvider),this.abis[r]=n,this.addresses[r]=t},n.erc20=function(e){return I(e),this._getToken(e,x.ERC20)},n.eToken=function(e){return I(e),this._getToken(e,x.EToken)},n.dToken=function(e){return I(e),this._getToken(e,x.DToken)},n.pToken=function(e){return I(e),this._getToken(e,x.PToken)},n.eTokenOf=function(e){return I(e),this._getTokenOf(e,x.EToken)},n.dTokenOf=function(e){return I(e),this._getTokenOf(e,x.DToken)},n.pTokenOf=function(e){return I(e),this._getTokenOf(e,x.PToken)},n.buildBatch=function(e){var r=this;return e.map(function(e){var n=T({},e);if(n.staticCall){var t=r._batchItemToContract(n),i=t.interface.encodeFunctionData(n.method,n.args);n={allowError:n.allowError,contract:"exec",method:"doStaticCall",args:[t.address,i]}}var s=r._batchItemToContract(n);return{allowError:Boolean(n.allowError),proxyAddr:s.address,data:s.interface.encodeFunctionData(n.method,n.args)}})},n.simulateBatch=function(e,r){try{var n=this;return y.default(Array.isArray(r),"Expecting an array of batch items"),Promise.resolve(Promise.all([function(){try{return Promise.resolve(L(function(){return Promise.resolve(n.contracts.exec.callStatic.batchDispatchSimulate(n.buildBatch(r),e)).then(function(){})},function(e){if("BatchDispatchSimulation"!==e.errorName)throw e;return n.decodeBatch(r,e.errorArgs.simulation)}))}catch(e){return Promise.reject(e)}}(),function(){try{var t=r.filter(function(e){return!e.staticCall});return Promise.resolve(L(function(){return Promise.resolve(n.contracts.exec.estimateGas.batchDispatch(n.buildBatch(t||r),e)).then(function(e){return{gas:e}})},function(e){if(e.reason)for(var r,n=function(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return _(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,r):void 0}}(e))){n&&(e=n);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(F);!(r=n()).done;)if(e.reason.includes(r.value))return{error:{isLiquidityCheck:!0,value:e}};return{error:{isLiquidityCheck:!1,value:e}}}))}catch(e){return Promise.reject(e)}}()])).then(function(e){var r=e[1];return{simulation:e[0],gas:r.gas,error:r.error}})}catch(e){return Promise.reject(e)}},n.decodeBatch=function(e,r){for(var n=[],t=0;t<r.length;t++){var i=e[t],s=void 0;try{s={success:!0,response:this._batchItemToContract(i).interface.decodeFunctionResult(i.method,r[t].result)}}catch(e){s={success:!1,response:z(e)}}n.push(s)}return n},n.signPermit=function(r,n,t){var i=n.spender,s=void 0===i?this.contracts.euler.address:i,o=n.value,a=void 0===o?e.ethers.constants.MaxUint256:o,u=n.allowed,c=void 0===u||u,d=n.deadline,l=void 0===d?q(3600):d;void 0===t&&(t=this.getSigner()),y.default(e.ethers.Signer.isSigner(this._signerOrProvider),"Signer in not provided"),y.default(r&&r.extensions&&r.extensions.permit,"Invalid token or missing permit config");var f=r.extensions.permit;return function(r,n,t,i){var s=n.type,o=n.variant,a=n.domain,u=t.spender,c=t.value,d=t.allowed,l=t.deadline;try{if(!e.ethers.Signer.isSigner(i))throw new Error("Invalid signer");var f=i._signTypedData?i._signTypedData.bind(i):i.signTypedData.bind(i);return Promise.resolve(i.getAddress()).then(function(n){var t;function h(o){var c;if(t)return o;function h(e){if(c)return e;throw new Error("Unknown permit type: "+s)}var v=function(){if("ALLOWED"===s){var t=new e.ethers.Contract(r,S,i);return Promise.resolve(t.nonces(n)).then(function(r){return Promise.resolve(f(a,j,{holder:n,spender:u,nonce:r,expiry:l,allowed:d})).then(function(n){var t={signature:T({raw:n},e.ethers.utils.splitSignature(n)),nonce:r};return c=1,t})})}}();return v&&v.then?v.then(h):h(v)}var v=function(){if("EIP2612"===s){var d,h=function(){return Promise.resolve(f(a,A,{owner:n,spender:u,value:c,nonce:d,deadline:l})).then(function(r){var n={signature:T({raw:r},e.ethers.utils.splitSignature(r)),nonce:d};return t=1,n})},v=new e.ethers.Contract(r,"PACKED"===o?O:E,i),g="UNDERSCORE_NONCES"===o?Promise.resolve(v._nonces(n)).then(function(e){d=e}):Promise.resolve(v.nonces(n)).then(function(e){d=e});return g&&g.then?g.then(h):h()}}();return v&&v.then?v.then(h):h(v)})}catch(e){return Promise.reject(e)}}(r.address,{type:f.type,variant:f.variant,domain:f.domain},{spender:s,value:a,allowed:c,deadline:l},t)},n.signPermitBatchItem=function(r,n,t,i){var s=n.value,o=void 0===s?e.ethers.constants.MaxUint256:s,a=n.allowed,u=void 0===a||a,c=n.deadline,d=void 0===c?q(3600):c;void 0===t&&(t=!1);try{var l=this;return void 0===i&&(i=l.getSigner()),Promise.resolve(l.signPermit(r,{spender:l.contracts.euler.address,value:o,allowed:u,deadline:d},i)).then(function(e){var n=e.signature,i=r.extensions.permit;return"EIP2612"===i.type?"PACKED"===i.variant?{allowError:t,contract:"exec",method:"usePermitPacked",args:[r.address,o,d,n.raw]}:{allowError:t,contract:"exec",method:"usePermit",args:[r.address,o,d,n.v,n.r,n.s]}:{allowError:t,contract:"exec",method:"usePermitAllowed",args:[r.address,e.nonce,d,u,n.v,n.r,n.s]}})}catch(e){return Promise.reject(e)}},n._getToken=function(r,n){return this._tokenCache[n][r]||(this._tokenCache[n][r]=new e.ethers.Contract(r,n===x.ERC20?C:this.abis[n],"string"==typeof this._signerOrProvider?void 0:this._signerOrProvider)),this._signerOrProvider?this._tokenCache[n][r].connect(this._signerOrProvider):this._tokenCache[n][r]},n._getTokenOf=function(r,n){try{var t=function(e){return i[n](i._underlyingToTokenCache[r][n])},i=this;i._underlyingToTokenCache[r]||(i._underlyingToTokenCache[r]={});var s=function(){if(!i._underlyingToTokenCache[r][n]){var t,s=function(s){if(t===e.ethers.constants.AddressZero)throw new Error("No "+n+" found for underlying "+r);i._underlyingToTokenCache[r][n]=t},o=n===x.EToken?Promise.resolve(i.contracts.markets.underlyingToEToken(r)).then(function(e){t=e}):n===x.DToken?Promise.resolve(i.contracts.markets.underlyingToDToken(r)).then(function(e){t=e}):function(){if(n===x.PToken)return Promise.resolve(i.contracts.markets.underlyingToPToken(r)).then(function(e){t=e});throw new Error("Unsupported token type: "+n)}();return o&&o.then?o.then(s):s()}}();return Promise.resolve(s&&s.then?s.then(t):t())}catch(e){return Promise.reject(e)}},n._batchItemToContract=function(r){if(r.contract instanceof e.ethers.Contract)return r.contract;if(this.contracts[r.contract])return this.contracts[r.contract];if(r.address){if(r.contract===x.EToken)return this.eToken(r.address);if(r.contract===x.DToken)return this.dToken(r.address);if(r.contract===x.PToken)return this.pToken(r.address);if(r.contract===x.ERC20)return this.erc20(r.address)}throw new Error("Unknown contract "+r.contract)},n._loadEulerContracts=function(){var r=this,n=function(n){return new e.Contract(r.addresses[D(n)],r.abis[D(n)],"string"==typeof r._signerOrProvider?void 0:r._signerOrProvider)};return{euler:n("Euler"),exec:n("Exec"),liquidation:n("Liquidation"),markets:n("Markets"),swap:n("Swap"),eulStakes:n("EulStakes"),eulDistributor:n("EulDistributor"),eulerGeneralView:n("EulerGeneralView"),eul:new e.Contract(this.eulTokenConfig.address,this.abis.eul,"string"==typeof this._signerOrProvider?void 0:this._signerOrProvider)}},r}();exports.Euler=G,exports.utils=B;
//# sourceMappingURL=index.js.map
