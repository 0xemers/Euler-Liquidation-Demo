const ethers = require('ethers')
const hre = require("hardhat");

require('dotenv').config()

const provider = new ethers.providers.getDefaultProvider('http://127.0.0.1:8545/')
const EXEC_PROXY = '0x59828fdf7ee634aaad3f58b19fdba3b03e2d9d80'
const EXEC_ABI = require('./abi/exec.json')

async function liquidateDemo(address,data){
    await hre.network.provider.request({
        method: "hardhat_impersonateAccount",
        params: [address],
      });
    await hre.network.provider.request({
        method: "hardhat_setBalance",
        params: [address, ethers.utils.parseEther('10.0').toHexString()],
    })
    const impersonatedSigner = await provider.getSigner(address)
    const tx = {
        to: EXEC_PROXY,
        gasLimit: 3e7, 
        data: data
    }
    let hash = await impersonatedSigner.sendTransaction(tx);
    console.log(hash)
}



async function getBalance(address){
    let balance = await provider.getBalance(address)
    balance = ethers.utils.formatEther(balance)
    console.log("Wallet Address",address,"Wallet Balance",balance)
}

async function main(){
    // 同Token
    // let Address = "0xb1ae6893d748db81b7f53494e19d9fda39ba25a7"
    // await getBalance(Address)
    // await liquidateDemo(Address,"0xeb937aeb000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000002800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f43ce1d09050bafd6980dd43cde2ab9f18c85b34000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a46f70e66f0000000000000000000000002ec7641df0eff8659644c0f44199b0522e4232fb0000000000000000000000006b175474e89094c44da98b954eedeac495271d0f0000000000000000000000006b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000002748c7fa54738a14bf0b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e025e3ca2be02316033184551d4d3aa22024d9dc00000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044b390c0ab0000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003520d5a913427e6f0d6a83e07ccd4a4da316e4d300000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044c8a5fba300000000000000000000000000000000000000000000000000000000000000000000000000000000000000006b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000" + Address.slice(2))

    //不同Token
    let Address = "0xd1a7e1d3dc39e7f15613e12dc1b9c458e161b46f"
    await getBalance(Address)
    await liquidateDemo(Address, "0xeb937aeb000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f43ce1d09050bafd6980dd43cde2ab9f18c85b34000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a46f70e66f000000000000000000000000513990a873c83dee4a7122ce48175ff71cb0a68b000000000000000000000000d9fcd98c322942075a5c3860693e9f4f03aae07b0000000000000000000000007f39c581f595b53c5cb19bd0b3f8da6c935e2ca000000000000000000000000000000000000000000000002925c98f857d79919400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007123c8cbbd76c5c7fcc9f7150f23179bec0ba341000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001842284879500000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000373b89a4a48253d8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000042d9fcd98c322942075a5c3860693e9f4f03aae07b002710c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f47f39c581f595b53c5cb19bd0b3f8da6c935e2ca00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003520d5a913427e6f0d6a83e07ccd4a4da316e4d300000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044c8a5fba30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d9fcd98c322942075a5c3860693e9f4f03aae07b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000" + Address.slice(2))
    await getBalance(Address)
}

main()